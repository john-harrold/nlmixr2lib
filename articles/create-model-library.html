<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nlmixr2lib">
<title>Creating a model library • nlmixr2lib</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating a model library">
<meta property="og:description" content="nlmixr2lib">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nlmixr2lib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/create-model-library.html">Creating a model library</a>
    <a class="dropdown-item" href="../articles/list-of-models.html">List of models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/nlmixr2lib/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Creating a model library</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/nlmixr2lib/blob/HEAD/vignettes/create-model-library.Rmd" class="external-link"><code>vignettes/create-model-library.Rmd</code></a></small>
      <div class="d-none name"><code>create-model-library.Rmd</code></div>
    </div>

    
    
<p>Model libraries are useful to have consistent high-quality basic
models that can be used as a model itself or as a building block for
other models.</p>
<div class="section level2">
<h2 id="model-library-conventions-within-nlmixr2lib">Model library conventions within nlmixr2lib<a class="anchor" aria-label="anchor" href="#model-library-conventions-within-nlmixr2lib"></a>
</h2>
<p>Compartment and parameter names should be all lower case when on
their own and should use snakeCase when combined in some way.</p>
<p>Compartment and parameter names are selected to align with those used
by <code>rxode2::linCmt()</code> which are described in the vignette:
vignette(“rxode2-model-types”, package = “rxode2”).</p>
<div class="section level3">
<h3 id="compartment-naming">Compartment naming<a class="anchor" aria-label="anchor" href="#compartment-naming"></a>
</h3>
<p>Compartment naming follows compartment names with the
<code>linCmt()</code> with augmentation for other compartments:</p>
<ul>
<li>
<code>depot</code>: The extravascular dosing compartment (for
example, the gut for oral dosing or subcutaneous space for subcutaneous
dosing)</li>
<li>
<code>central</code>: The intravascular compartment used for
intravenous dosing or for typical pharmacokinetic (PK) model sampling of
the drug</li>
<li>
<code>peripheral1</code>, <code>peripheral2</code>: The first and
second peripheral compartments for 2- and 3-compartment PK models</li>
<li>
<code>effect</code>: The compartment for effect compartment
models</li>
<li>Therapeutic-area-specific models should use consistent compartment
and parameter naming. When adding a new therapeutic area model to the
library, please discuss naming first in a new GitHub issue.</li>
</ul>
</div>
<div class="section level3">
<h3 id="estimated-parameter-naming">Estimated parameter naming<a class="anchor" aria-label="anchor" href="#estimated-parameter-naming"></a>
</h3>
<p>To enable more consistent cross-model compatibility, the following
conventions should be used unless there is a strong reason for an
exception:</p>
<ul>
<li>Pharmacokinetic concentrations in the central compartment should be
named <code>Cc</code>. <code>Cc</code> should be used even when using a
<code>linCmt()</code> model (in which case
<code>Cc &lt;- linCmt()</code> should be used and the residual error
should be applied to the <code>Cc</code> parameter).</li>
<li>Therapeutic-area-specific models should use consistent compartment
and parameter naming. When adding a new therapeutic area model to the
library, please discuss naming first in a new GitHub issue.</li>
</ul>
</div>
<div class="section level3">
<h3 id="parameter-naming">Parameter naming<a class="anchor" aria-label="anchor" href="#parameter-naming"></a>
</h3>
<p>PK models should use the following parameter naming conventions:</p>
<ul>
<li>
<code>ka</code>: absorption rate</li>
<li>
<code>cl</code>: clearance</li>
<li>
<code>q</code>: intercompartmental clearance (<code>central</code>
to and from <code>peripheral1</code> compartments)</li>
<li>
<code>q2</code>: second intercompartmental clearance
(<code>central</code> to and from <code>peripheral2</code>
compartments)</li>
<li>
<code>vc</code>: central volume of distribution</li>
<li>
<code>vp</code>, <code>vp2</code>: first and second peripheral
compartment volumes</li>
</ul>
<p>When micro-constants are used, they should use the following naming
conventions:</p>
<ul>
<li>
<code>kel</code> elimination rate (<code>cl/vc</code>)</li>
<li>
<code>k12</code>, <code>k21</code>, <code>k13</code>,
<code>k31</code>: intercompartmental transit rates (<code>q/vc</code>,
<code>q/vp</code>, <code>q2/vc</code>, and <code>q2/vp2</code>,
respectively)</li>
</ul>
</div>
<div class="section level3">
<h3 id="parameter-transforms">Parameter transforms<a class="anchor" aria-label="anchor" href="#parameter-transforms"></a>
</h3>
<p>Parameters are often estimated on a transformed scale. For instance,
a natural logarithm transform is often used for parameters that must be
positive, and a logit transform is often used when a parameter must
remain within a specific range.</p>
<p>Transformed parameters should be prefixed with an indicator of the
transformation. Preferred transformation prefixes are:</p>
<ul>
<li>
<code>l</code> (lower case L): natural log transform</li>
<li>
<code>logit</code>: logit transform</li>
<li>
<code>probit</code>: probit transform</li>
<li>Any other transform should similarly include the full transform as
the prefix</li>
</ul>
<p>Generally, for any transform other than natural logarithm, include
the full name as a prefix. For example, natural logarithm-transformed
<code>ka</code> would be <code>lka</code> and logit-transformed
<code>emax</code> would be <code>logitemax</code>.</p>
</div>
<div class="section level3">
<h3 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>Random effects are estimates as part of a distribution varying by
some grouping factor. The grouping factor is often a subject in a
clinical trial. (For NONMEM users, random effects are often referred to
as inter-individual variability.)</p>
<p>Random effect parameters should prefix the (transformed) parameter
name with <code>eta</code>. For example, a random effect on
log-transformed clearance would be named <code>etalcl</code>.</p>
</div>
<div class="section level3">
<h3 id="drug-effects">Drug effects<a class="anchor" aria-label="anchor" href="#drug-effects"></a>
</h3>
<p>Different drug effects may be investigated during model building.
And, multiple drug effect styles (linear, E<sub>max</sub>, threshold,
etc.) may be investigated by the user.</p>
<p>To enable simpler changes to drug effects and to minimize the chance
of parameter name collisions when combining models, the following rules
are strongly recommended:</p>
<ul>
<li>Drug effects should be calculated on a model by themselves to enable
changing the type of drug effect (e.g. linear to E<sub>max</sub>).</li>
<li>The parameter name for the drug effect should be called
<code>drugEffect</code> followed by the name of the part of the model
that is most closely associated with the drug effect. For example, in
the Simeoni 2004 model, the drug effect is called
<code>drugEffectCyclingCells</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="model-files">Model files<a class="anchor" aria-label="anchor" href="#model-files"></a>
</h2>
<p>Files in a model library should have the following
characteristics:</p>
<ul>
<li><p>The first line inside the function should have a description
assignment. That is
<code>description &lt;- "This is the description of the model"</code>
right inside the <code>function()</code> before the <code>ini({})</code>
block.</p></li>
<li><p>If the model has a literature reference associated with it, then
the second line of inside the function should have the reference, for
example,
<code>reference &lt;- "Richard Hooijmaijers, Matthew Fidler, William S. Denney (2022).  nlmixr2lib: A Model Library for 'nlmixr2'.  https://nlmixr2.github.io/nlmixr2lib/"</code></p></li>
<li><p>If it would be helpful to give the user some information about
the model on load, it can be added as meta-data as a
<code>"message"</code> attribute to the model. Note that in that case,
you must give the function name as the last line of the model to ensure
that it is the returned value from evaluation of the file. (See
<code>oncology_xenograft_simeoni_2004.R</code> for an example of adding
a message.)</p></li>
<li><p>If the model is to be combined with other models and it expects
certain objects will be defined a depends value should be specified. For
example if there is a tumor growth model that is driven by the drug
concentration in the central compartment, then the following could be
used: <code>depends &lt;-c("Cc")</code></p></li>
<li><p>It can also be helpful to specify the compartments where dosing
is expected. This can be done in the following manner:
<code>dosing &lt;- c("central", "depot")</code></p></li>
<li><p>Units used in the model can be specified using a list
<code>units  &lt;- list(dosing= "mg/kg", time="hr")</code> To add more
fields to this list please discuss first in a GitHub issue.</p></li>
<li><p>The remainder of the file should be an nlmixr2 model in a
function with a typical <code><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini()</a></code> and <code><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model()</a></code>
block.</p></li>
<li><p>The name of the file should match the name of the model within
the file.</p></li>
</ul>
<p>If a function to modify, self-start, or otherwise help the user would
make sense, add it as a new file in the <code>R/</code> directory with
the file name and function name <code>updateModelName()</code> using the
word update followed by the model name in camelCase
(e.g. <code>updateOncologyXenograftSimeoni2004</code>). If such a
function is added, please add it in the <code>messages</code> described
above, as well. Update functions must be able to take in a function, an
rxUi object, or an nlmixr2fitCore object and should usually return an
rxUi object.</p>
<p>For examples, see the package installation directory.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Hooijmaijers, Matthew Fidler, Bill Denney.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
